---
import { Image as AstroImage, getImage } from "astro:assets";

import type { ComponentProps } from "astro/types";

type Props = Prettify<ComponentProps<typeof AstroImage>>;

let { src, alt, width, height, title } = Astro.props;
if (typeof src === "string") {
  const inferRemoteSize = await import("astro:assets").then(
    (r) => r.inferRemoteSize,
  );
  const { format, width: w, height: h } = await inferRemoteSize(src);

  const remote_img = await getImage({ src, format, width: w, height: h });
  src = remote_img.src;
  width = remote_img.options.width;
  height = remote_img.options.height;
}
---

{/* @ts-expect-error */}
<AstroImage
  src={src}
  alt={alt}
  width={width}
  height={height}
  class=""
  title={title}
/>
